<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HonorsApplication_II.Pages.Tasks"
             xmlns:viewmodel="clr-namespace:HonorsApplication_II.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:models="clr-namespace:HonorsApplication_II.ProgramClasses"
             x:DataType="viewmodel:TasksViewModel"
             Title="{Binding CurrentProject.projectName}">


        <!-- Allows the user to Scroll Form this point -->
    <ScrollView HorizontalOptions="Center">

        <Grid 
            RowDefinitions="Auto,Auto,Auto,*,Auto"
            ColumnDefinitions=".01*, .98*, .01*" 
            Padding="10"
            RowSpacing="10"
            ColumnSpacing="10">

            <Frame Grid.Column="1" Grid.Row="0" BackgroundColor="Transparent" BorderColor="LightGrey" CornerRadius="10">

                <Grid
                    ColumnDefinitions=".1*,.8*,.1*"
                    Padding="5"
                    ColumnSpacing="5">

                    <Label Text="Doing" HorizontalOptions="Center" BackgroundColor="Transparent" Grid.Column="1"/>

                    <Label Text="{Binding DoingTasks.Count}" BackgroundColor="Transparent" Grid.Column="2"/>

                </Grid>

                <Frame.GestureRecognizers>
                    <DropGestureRecognizer DropCommand="{Binding TaskDraggedOverCatagoryCommand}" DropCommandParameter="Doing"/>
                </Frame.GestureRecognizers>

            </Frame>



            <CollectionView ItemsSource="{Binding DoingTasks}" Grid.Column="1" Grid.Row="1" CanReorderItems="True">

                
                <CollectionView.ItemTemplate>

                    

                    <DataTemplate x:DataType="models:Task">

                        <SwipeView>

                            <SwipeView.RightItems>

                                <SwipeItems>
                                    
                                    <SwipeItem Text="Remove" BackgroundColor="IndianRed" Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=DeleteTaskCommand}" CommandParameter="{Binding .}"/>
                                    <SwipeItem Text="Done!" BackgroundColor="LightGreen" Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=CompleteTaskCommand}" CommandParameter="{Binding .}"/>
                                    
                                </SwipeItems>

                            </SwipeView.RightItems>

                        <Frame Padding="0,5" BackgroundColor="Transparent">

                            

                            <Frame.GestureRecognizers>

                                <DragGestureRecognizer CanDrag="True" 
                                                       DragStartingCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=TaskDraggedCommand}" 
                                                       DragStartingCommandParameter="{Binding .}"
                                                       />
                                

                                <DropGestureRecognizer AllowDrop="True" 
                                                       DropCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=TaskDraggedOverCommand}"
                                                       DropCommandParameter="{Binding .}"
                                                       />

                            </Frame.GestureRecognizers>

                            <Grid 
                               RowDefinitions="Auto"
                               ColumnDefinitions=".4*,.45*,.15*"
                               Padding="5"
                               RowSpacing="5"
                               ColumnSpacing="5">

                                <Label Text="{Binding taskName}" FontAttributes="Bold" BackgroundColor="Transparent"/>

                                <Label Text="{Binding taskPoints, StringFormat='{}{0} Story Points'}" Grid.Column="1" HorizontalOptions="Start" BackgroundColor="Transparent"/>

                                <Label Text="{Binding taskCatagory}" Grid.Column="2" HorizontalOptions="End" BackgroundColor="Transparent"/>

                            </Grid>

                        </Frame>

                        </SwipeView>

                    </DataTemplate>

                </CollectionView.ItemTemplate>

            </CollectionView>

            <Frame Grid.Column="1" Grid.Row="2" BackgroundColor="Transparent" BorderColor="LightGrey" CornerRadius="10">

                <Grid
                    ColumnDefinitions=".1*,.8*,.1*"
                    Padding="5"
                    ColumnSpacing="5">

                    <Label Text="To-Do" HorizontalOptions="Center" BackgroundColor="Transparent" Grid.Column="1"/>

                    <Label Text="{Binding TodoTasks.Count}" BackgroundColor="Transparent" Grid.Column="2"/>

                </Grid>

                <Frame.GestureRecognizers>
                    <DropGestureRecognizer DropCommand="{Binding TaskDraggedOverCatagoryCommand}" DropCommandParameter="To-Do"/>
                </Frame.GestureRecognizers>

            </Frame>


            <CollectionView ItemsSource="{Binding TodoTasks}" Grid.Column="1" Grid.Row="3" CanReorderItems="True">

        
                <CollectionView.ItemTemplate>

          
                    <DataTemplate x:DataType="models:Task">

                        <SwipeView>

                            <SwipeView.RightItems>
                                
                                <SwipeItems>

                                    <SwipeItem Text="Remove" BackgroundColor="IndianRed" Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=DeleteTaskCommand}" CommandParameter="{Binding .}"/>
                                    <SwipeItem Text="Done!" BackgroundColor="LightGreen" Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=CompleteTaskCommand}" CommandParameter="{Binding .}"/>

                                </SwipeItems>
                                
                            </SwipeView.RightItems>

                            <Frame Padding="0,5" BackgroundColor="Transparent">

                                <Frame.GestureRecognizers>

                                    <DragGestureRecognizer CanDrag="True" 
                                                       DragStartingCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=TaskDraggedCommand}" 
                                                       DragStartingCommandParameter="{Binding .}"
                                                       />


                                    <DropGestureRecognizer AllowDrop="True" 
                                                       DropCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:TasksViewModel}}, Path=TaskDraggedOverCommand}"
                                                       DropCommandParameter="{Binding .}"
                                                       />

                                </Frame.GestureRecognizers>

                                <Grid 
                               RowDefinitions="Auto"
                               ColumnDefinitions=".4*,.45*,.15*"
                               Padding="5"
                               RowSpacing="10"
                               ColumnSpacing="5">


                                    <Label Text="{Binding taskName}" FontAttributes="Bold" BackgroundColor="Transparent"/>

                                    <Label Text="{Binding taskPoints, StringFormat='{}{0} Story Points'}" Grid.Column="1" HorizontalOptions="Start" BackgroundColor="Transparent"/>

                                    <Label Text="{Binding taskCatagory}" Grid.Column="2" HorizontalOptions="End" BackgroundColor="Transparent"/>

                                </Grid>

                            </Frame>

                        </SwipeView>

                    </DataTemplate>

                </CollectionView.ItemTemplate>

            </CollectionView>

            <Frame BackgroundColor="Transparent" BorderColor="LightGrey" CornerRadius="10" Grid.Row="4" Grid.Column="1" >

                <Label Text="New Task" HorizontalOptions="Center" BackgroundColor="Transparent" Grid.Column="1"/>

                <Frame.GestureRecognizers>

                    <TapGestureRecognizer Command="{Binding NewTaskCommand}"/>

                </Frame.GestureRecognizers>

            </Frame>

        </Grid>

    </ScrollView>

    

</ContentPage>